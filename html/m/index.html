<html>
  <head>
<title>Stellar Expanse</title>
<link rel="stylesheet" href="/yote/css/jquery.mobile.css">
<script type="text/javascript" src="/yote/js/jquery-latest.js"></script>
<script type="text/javascript" src="/yote/js/jquery-mobile-latest.js"></script>
<script src="/yote/js/jquery.dumper.js"></script>
<script src="/yote/js/jquery.cookie.js"></script>
<script src="/yote/js/jquery.base64.min.js"></script>
<script src="/yote/js/json2.js"></script>
<script src="/yote/js/yote.js"></script>
<script src="/yote/js/yote.util.js"></script>
<script src="/yote/js/yote-mobile.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">

  <script>
    $(document).bind( 'mobileinit', function() { alert(1) } );
    $().ready( function() { 
       $.yote.init();
       var se_app = $.yote.fetch_app( 'StellarExpanse::App' );

       function message(m) {
	   
       }
       function welcome() {
	   show_games();
       }
       function show_games(msg) {
	   var acct, active_games, i, pending_games, avail_games;
           message(msg);
	   $( '#game_select_ul' ).empty();
           acct = se_app.account();
           active_games  = acct.get_active_games();
	   if( active_games.length() > 0 ) {
	       html = '<li>Active Games <ul data-role="listview">';
	       for( i=0; i<active_games.length(); ++i ) {
		   game = active_games.get(i);
		   html += '<li>' + game.get_name() + ' <ul data-role="listview">' +
		       '<li><b>Number Players</b> ' + game.get_number_players() + '</li>' +
		       '<li><b>Created By</b> ' + game.get_created_by().get_handle() + '</li>' + 
		       '<li><b>Enter Game</b></li>' + 
		       '</ul></li>';
	       }
	       html += '</ul></li>';
	       $( '#game_select_ul' ).append( html );
	   } else {
	       $( '#game_select_ul' ).append( '<li>No Active Games</li>' );
	   }
           pending_games = acct.get_pending_games();
	   if( pending_games.length() > 0 ) {
	       html = '<li>Pending Games <ul data-role="listview">';
	       for( i=0; i<pending_games.length(); ++i ) {
		   game = pending_games.get(i);
		   html += '<li>' + game.get_name() + ' <ul data-role="listview">' +
		       '<li><b>Joined Players</b> ' + game.joined_playercount() + ' of ' + game.get_number_players() + '</li>' +
		       '<li><b>Created By</b> ' + game.get_created_by().get_handle() + '</li>' + 
		       '</ul></li>';
	       }
	       html += '</ul></li>';
	       $( '#game_select_ul' ).append( html );
	   }

           avail_games   = se_app.available_games();           
	   if( avail_games.length() > 0 ) {
	       html = '<li>Avail Games <ul data-role="listview">';
	       for( i=0; i<avail_games.length(); ++i ) {
		   game = avail_games.get(i);
		   html += '<li>' + game.get_name() + ' <ul data-role="listview">' +
		       '<li><b>Number Players</b> ' + game.get_number_players() + '</li>' +
		       '<li><b>Created By</b> ' + game.get_created_by().get_handle() + '</li>' + 
		       '<li><b>Join Game</b></li>' + 
		       '</ul></li>';
	       }
	       html += '</ul></li>';
	       $( '#game_select_ul' ).append( html );
	   } else {
	       $( '#game_select_ul' ).append( '<li>No Available Games</li>' );
	   }
	   $( '#game_select_ul' ).append( '<button type=button id=create_game_b>Create Game</button>' );
	   $( '#create_game_b' ).click( function() {
	       var buff;
	       var flavors = se_app.get_flavors();
	       buff = '    <label for=new_game_name>Name</label>' +
		   '<input type=text id=new_game_name>';		   
	       if( flavors.length() > 1 ) {
		   buff += '<label for=new_game_flavor>Flavor</label>' + 
		       '<select id=new_game_flavor>';
		   for( var i=0; i<flavors.length(); ++i ) {
		       var flav = flavors.get(i);
		       buff += '<option value=' + flav.id + '>' + flav.get_name() + '</option>';
		   }
		   buff += '</select>';
	       } else if( flavors.length() == 1 ) {
		   flav = flavors.get(0);
		   buff += 'Flavor : ' + '<input type=text display=hidden id=new_game_flavor value=' + flav.id + '>' +
		       flav.get_name();
	       } else {
		   alert( 'no flavors defined. game error' );
	       }
	       buff += '<label for=new_game_players>Number of Players</label>' +
		   '<input type=range id=new_game_players min=1 max=10 value=4>' +
		   '<label for=new_game_tech>Starting Tech Level</label>' +
		   '<input type=range id=new_game_tech min=1 max=4 value=1>' +
		   '<label for=new_game_resource>Starting Resources</label>' +
		   '<input type=range id=new_game_tech min=0 max=1000 value=100>' +
		   '<button type=button id=new_game_b>Create</button>';
	       $( '#create_page_content' ).empty().append( buff );
	       $.mobile.changePage( $('#create_page') );
	   } );
       }
       $.yote.util.make_login_box( {
	   target:'#login_div',
	   on_login:welcome,
	   on_register:welcome,
       } );
   } );
 </script>
</head>
<body>

<div data-role="page" id=main_page>
  <div data-role="header">
    Stellar Expanse <div id='login_div'></div>
  </div>
  <div data-role="content">
      <ul data-role="listview" id=game_select_ul>
      </ul>
    </ul>
  </div>
  <div data-role="footer">
    footer
  </div>
</div>

<div data-role="page" id=create_page>
  <div data-role="header">
    Stellar Expanse
  </div>
  <div data-role="content" id=create_page_content>
  </div>
  <div data-role="footer">
    footer
  </div>  
</div>

</body>
</html>
