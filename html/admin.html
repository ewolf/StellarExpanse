<html>
  <head>
<title>Stellar Exapnse Admin</title>

    <script src="/js/jquery-latest.js"></script>
    <script src="/js/jquery.dumper.js"></script>
    <script src="/js/jquery.base64.min.js"></script>
    <script src="/js/json2.js"></script>
    <script src="/js/yote/yote.js"></script>
    <script src="/js/yote/yote.util.js"></script>
    <script>
    $().ready(function(){
	    $('div.info').hide();
        var se_app = $.yote.get_app( 'StellarExpanse::App' );
	    
	    $('#nav a').each( function(idx) {
	        $( this ).click( function() { 
		        $('div.info').hide();  
		        $( '#' + $(this).attr("id").split('_')[0] + "_div" ).show();
	        } );
	    } );

        var editing;

	    /*
	      set up flavors to be edited.
	    */
	    function edit_flavor( flav ) {
            editing = flav;
	        $('#flavor_edit_box').empty();
	        $('#flavor_edit_box').append( '<button type=button id=save>Save</button> ' + 
                                          ' <button type=button id=reset>Reset</button> <BR><br>Name : ' );
            $.yote.util.stage_text_field( $('#flavor_edit_box'), editing, 'name' );

            $('#flavor_edit_box').append( '<p>ToDO : have a registry of javascript object to form control and vice versa, and build a page object that is aware of the objects in it and how a change in the object and a change in the control interact' );

            $('#flavor_edit_box').append( '<h2>Ships</h2><table border=1 id=ship_tab><tr></tr></table>' );
            var fields = {
	            name:'Name',
	            tech_level:'Tech Level',
	            damage_control:'Damage Control',
	            jumps:'Jumps',
	            cost:'Cost',
	            targets:'Targets',
	            self_destruct:'Self Destruct',
	            attack_beams:'Attack Beams',
	            defense:'Defense',
	            size:'Size',
	            racksize:'Rack Size'
            };
            var field_keys = Array();
            for( var key in fields ) { 
                $('#ship_tab tr').append( "<th>" + fields[key] + '</th>' );
            }
            $('#reset').click( function() { if( confirm("Really Revert?") ) { edit_flavor(editing) }} );

	        var ships = flav.get('ships');
            ships.load_direct_descendents();

            $('#save').click( function() {
                editing.send_update();
                for( var i=0; i<ships.length(); ++i ) {
                    ships.get(i).send_update();
                }
                edit_flavor(editing);
            } );

	        for( var i=0; i<ships.length(); ++i ) {
                var ship = ships.get(i);
                $( '#ship_tab' ).append( '<tr id=ship_'+i+'>' );
                for( var key in fields ) {
                    var tr = $( 'tr#ship_' + i ).append('<td id=ship_' + i + '_' + key + ' >');
		            $.yote.util.stage_text_field( $('#ship_' + i + '_' + key ), ship, key );
                }
            }
	    } //edit flavor
	    var flavs = se_app.flavors();

	    $('#flavor_div').append( "<div id=flavor_selector_box>Available Flavors <select id=flavor_sel></select><br><input type=submit id=flavor_new_sub value=\"New Flavor\"></div><div id=flavor_edit_box></div>" );
	    for( var i=0; i<flavs.length(); i++ ) {
	        var flav = flavs.get(i);
	        $('#flavor_sel').append( "<option id=flavor_" + i + ">" + flav.get('name') + "</option>" );
	    }
	    $('#flavor_new_sub').click(
	        function() {
		        var newflav = se_app.new_flavor();
		        $('#flavor_sel').append( "<option id=flavor_" + (flavs.length()-1) + ">" + newflav.get('name') + "</option>" );
                edit_flavor( newflav );
	        }
	    );
        edit_flavor( flavs.get(0) );
        
	    $( '#flavor_div' ).show();
        
    } );
    </script>

<style>
    ul#nav { list-style-type:none;
	     margin:0px;
	     padding:0px;
	   }
ul#nav li { display:inline; float: left; }
ul#nav a { width:120px; display:block; padding: 5px;border:1px solid black; }
</style>

</head>

<body>
<h1>Stellar Exapnse Admin</h1>
<table><tr><td>
  <div id=nav>
    <ul id=nav>
      <li><a id=flavor_li href=#>Edit Flavors</a></li>
      <li><a id=config_li href=#>Edit Configs</a></li>
      <li><a id=player_li href=#>Show Players</a></li>
      <li><a id=stats_li href=#>Stats</a></li>
    </ul>
  </div>
</td></tr><tr><td>
  <div id=body>
    <div class=info id=flavor_div></div>
    <div class=info id=config_div></div>
    <div class=info id=player_div></div>
    <div class=info id=stats_div></div>
  </div>
</td></tr></table>
</body>
</html>
